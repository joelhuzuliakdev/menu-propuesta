---
import Layout from "../layouts/Layout.astro";
import { products, categories } from "../data/products";

// mini debug en servidor: miralo en la terminal de `npm run dev`
console.log("Productos cargados en Astro:", products?.length);
---

<Layout title="Fast Food - Delivery">
  <main class="min-h-screen bg-gradient-to-b from-zinc-950 via-zinc-900 to-zinc-950">
    <section class="container mx-auto px-4 py-8">
      <!-- HEADER / NAV CON LOGO + BOT√ìN CARRITO -->
      <section class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <div
            class="h-12 w-12 rounded-full bg-amber-400 flex items-center justify-center text-zinc-950 text-xl font-black shadow-lg shadow-amber-500/40"
          >
            GM
          </div>
          <div class="flex flex-col leading-tight">
            <h1 class="text-2xl font-semibold text-zinc-50">
              Grill Master
            </h1>
            <p class="text-sm text-zinc-400">
              Hamburguesas, pizzas, hot dogs y m√°s con pedido directo por WhatsApp üçî
            </p>
          </div>
        </div>

        <button
          id="btn-open-cart"
          class="inline-flex items-center gap-2 rounded-full border border-amber-400 bg-zinc-900 px-4 py-2 text-sm font-medium text-amber-300 hover:bg-amber-400 hover:text-zinc-950 transition shadow-md shadow-amber-500/30"
          type="button"
        >
          <span>Ver carrito</span>
          <span
            class="text-xs bg-amber-500 text-zinc-950 rounded-full px-2 py-[2px]"
          >
            0
          </span>
        </button>
      </section>

      <!-- FILTROS -->
      <section
        id="filters"
        class="flex flex-wrap gap-2 justify-center mb-8 text-sm"
      >
        {
          categories.map((cat) => (
            <button
              type="button"
              data-filter={cat.id}
              class={`filter-btn px-4 py-2 rounded-full border text-xs uppercase tracking-wide transition ${
                cat.id === "todos"
                  ? "bg-amber-400 border-amber-400 text-zinc-950 font-semibold shadow shadow-amber-500/40"
                  : "bg-zinc-900 border-zinc-700 text-zinc-300 hover:bg-zinc-800"
              }`}
            >
              {cat.name}
            </button>
          ))
        }
      </section>

      <!-- mini texto para asegurar que products llega -->
      <p class="text-xs text-zinc-400 mb-4">
        Mostrando {products.length} productos
      </p>

      <!-- GRID DE PRODUCTOS (render directo con Astro) -->
      <section
        id="products-grid"
        class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"
      >
        {
          products.map((product) => (
            <article
              class="product-card bg-zinc-900/90 border border-zinc-800 rounded-2xl overflow-hidden flex flex-col shadow-lg shadow-black/50 hover:-translate-y-1 hover:shadow-2xl transition"
              data-category={product.category}
            >
              <div class="h-40 w-full bg-zinc-800 overflow-hidden">
                <img
                  src={product.image}
                  alt={product.name}
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
              </div>

              <div class="p-4 flex flex-col flex-1">
                <div class="flex items-start justify-between gap-2 mb-2">
                  <h3 class="font-semibold text-zinc-50 text-sm">
                    {product.name}
                  </h3>
                  <span class="text-amber-400 font-bold text-sm">
                    ${product.price.toFixed(2)}
                  </span>
                </div>

                <p class="text-xs text-zinc-400 mb-3">
                  {product.description}
                </p>

                <div class="mt-auto flex gap-2">
                  <button
                    type="button"
                    class="flex-1 rounded-full border border-zinc-600 px-3 py-2 text-[11px] font-medium text-zinc-200 hover:bg-zinc-800 transition"
                  >
                    Ver m√°s
                  </button>
                  <button
                    type="button"
                    class="flex-1 rounded-full bg-amber-400 px-3 py-2 text-[11px] font-semibold text-zinc-950 hover:bg-amber-300 transition"
                  >
                    Agregar
                  </button>
                </div>
              </div>
            </article>
          ))
        }
      </section>
    </section>
  </main>

  <!-- JS SOLO PARA FILTRAR (ocultar/mostrar) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log("üçî Filtros activos");

      let activeFilter = "todos";

      const filterButtons = document.querySelectorAll(".filter-btn");
      const cards = document.querySelectorAll(".product-card");

      function aplicarFiltro() {
        cards.forEach((card) => {
          const cardCategory = card.dataset.category;
          if (activeFilter === "todos" || cardCategory === activeFilter) {
            card.classList.remove("hidden");
          } else {
            card.classList.add("hidden");
          }
        });
      }

      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          activeFilter = btn.dataset.filter;

          // estilos de bot√≥n activo / inactivo
          filterButtons.forEach((b) => {
            b.classList.remove(
              "bg-amber-400",
              "border-amber-400",
              "text-zinc-950",
              "font-semibold",
              "shadow",
              "shadow-amber-500/40"
            );
            b.classList.add("bg-zinc-900", "border-zinc-700", "text-zinc-300");
          });

          btn.classList.remove("bg-zinc-900", "border-zinc-700", "text-zinc-300");
          btn.classList.add(
            "bg-amber-400",
            "border-amber-400",
            "text-zinc-950",
            "font-semibold",
            "shadow",
            "shadow-amber-500/40"
          );

          aplicarFiltro();
        });
      });

      // primer render
      aplicarFiltro();
    });
  </script>
</Layout>
